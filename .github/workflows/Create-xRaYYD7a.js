import{d as q,k as A,a as y,c as w,b as a,e as r,w as d,f as k,h as n,t as N,F as V,p as F,g as j,_ as G}from"./index-Dk3O8imR.js";const I={class:"create-layout"},O={class:"create-button"},P={class:"record"},W=["id"],z=["onClick"],H={class:"item-func"},_={class:"item-context"},J=q({__name:"Create",setup(K){const s=A([]);function L(o){let e=prompt("edit the sound name");e&&(s.value[o].title=e)}function M(o,e){let i=new Audio(e);i.muted=!1;const t=document.querySelector("#record-item-"+o+" #canvas"),l=document.querySelector("#record-item-"+o+" .item-latest-time");let U=new Date().getSeconds(),E=()=>{let c=new Date().getSeconds()-U;l.innerHTML=c,!(s.value[o].duration<=c||c<0)&&setTimeout(E,500)};setTimeout(E,500);const u=t.getContext("2d");let v=new AudioContext,B=v.createMediaElementSource(i);var m=v.createAnalyser(),C=v.createGain();B.connect(C),C.connect(m),m.smoothingTimeConstant=1,m.fftSize=2048;var T=m.frequencyBinCount,S=new Uint8Array(T);function x(){C.gain.setValueAtTime(10,v.currentTime),m.getByteTimeDomainData(S),u.clearRect(0,0,t.width,t.height),u.lineWidth=2,u.strokeStyle="rgb(0, 0, 0)",u.beginPath();for(var h=t.width*1/T,c=0,g=0;g<T;g++){var $=S[g]/128-1,R=$*t.height/2+t.height/2;g===0?u.moveTo(c,R):u.lineTo(c,R),c+=h}u.lineTo(t.width,t.height/2),u.stroke(),requestAnimationFrame(x)}x(),i.play().catch(h=>{console.error("Error playing audioELEMENT2:",h)})}function b(o,e){let i=URL.createObjectURL(o),t=new Audio(i);t.muted=!1,M(e,i),t.play().catch(l=>{console.error("Error playing audioELEMENT:",l)}),t.onended=()=>{URL.revokeObjectURL(i)}}function D(){for(let o=0;o<s.value.length;o++)b(s.value[o].blob,o)}let f={stream:null,audioCtx:null,source:null,analyserNode:null,gainNode:null,destinationNode:null,mediaRecorder:null,chunks:[],startTime:0,latestTime:A(0),clear(){this.stream=null,this.audioCtx=null,this.source=null,this.analyserNode=null,this.gainNode=null,this.destinationNode=null,this.mediaRecorder=null,this.chunks=[]},async recordStart(){let o=new Date;this.startTime=o.getSeconds(),this.latestTime.value=0;let e=null,i=()=>{let t=new Date;this.latestTime.value=t.getSeconds()-this.startTime,e=setTimeout(i,500)};e=setTimeout(i,500),this.stream=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),this.audioCtx=new AudioContext,this.source=this.audioCtx.createMediaStreamSource(this.stream),this.gainNode=this.audioCtx.createGain(),this.source.connect(this.gainNode),this.analyserNode=this.audioCtx.createAnalyser(),this.gainNode.connect(this.analyserNode),this.destinationNode=this.audioCtx.createMediaStreamDestination(),this.analyserNode.connect(this.destinationNode),this.mediaRecorder=new MediaRecorder(this.destinationNode.stream),this.mediaRecorder.ondataavailable=t=>{this.chunks.push(t.data)},this.mediaRecorder.onstop=()=>{clearTimeout(e);const t=new Blob(this.chunks,{type:"audio/wav"});s.value.push({blob:t,title:"title"+s.value.length,duration:this.latestTime.value}),this.latestTime.value=0},this.mediaRecorder.start()},recordStop(){this.stream.getAudioTracks().forEach(o=>o.stop()),this.audioCtx.close(),this.mediaRecorder.stop(),this.clear()}};return(o,e)=>{const i=j("el-button");return y(),w("div",I,[e[18]||(e[18]=a("h2",null,"a cappella Create",-1)),a("div",O,[r(i,{onClick:e[0]||(e[0]=()=>k(f).recordStart())},{default:d(()=>e[4]||(e[4]=[n("添加 ")])),_:1}),r(i,{onClick:e[1]||(e[1]=()=>k(f).recordStop())},{default:d(()=>e[5]||(e[5]=[n("停止")])),_:1}),r(i,{onClick:e[2]||(e[2]=t=>console.log("yet to write something"))},{default:d(()=>e[6]||(e[6]=[n("导出")])),_:1}),n(" "+N(k(f).latestTime),1)]),a("div",P,[a("div",null,[r(i,{onClick:D},{default:d(()=>e[7]||(e[7]=[n(" 全部播放")])),_:1}),r(i,null,{default:d(()=>e[8]||(e[8]=[n("全部静音")])),_:1}),r(i,{onClick:e[3]||(e[3]=t=>s.value=[])},{default:d(()=>e[9]||(e[9]=[n("全部删除")])),_:1})]),(y(!0),w(V,null,F(s.value,(t,l)=>(y(),w("div",{key:l,class:"record-item",id:"record-item-"+l},[a("h4",{onClick:p=>L(l)},N(t.title),9,z),a("div",H,[r(i,{onClick:p=>b(t.blob,l)},{default:d(()=>e[10]||(e[10]=[n("播放")])),_:2},1032,["onClick"]),r(i,{onClick:p=>s.value.splice(l,1)},{default:d(()=>e[11]||(e[11]=[n("删除")])),_:2},1032,["onClick"]),r(i,null,{default:d(()=>e[12]||(e[12]=[n("音量")])),_:1}),e[13]||(e[13]=a("div",{class:"gain-bar-ready-time"},"50",-1)),e[14]||(e[14]=a("div",{class:"item-gain-bar"},[a("div",{class:"gain-bar-ready"})],-1)),e[15]||(e[15]=a("div",{class:"gain-bar-over-time"},"100",-1))]),a("div",_,[e[16]||(e[16]=a("p",{class:"item-latest-time"},null,-1)),e[17]||(e[17]=a("canvas",{id:"canvas",width:"200",height:"100"},null,-1)),a("p",null,N(t.duration),1)])],8,W))),128))])])}}}),X=G(J,[["__scopeId","data-v-b6715382"]]);export{X as default};
